<!DOCTYPE html>
<html>

<head>
    <title>GPS Pulse Bridge</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background: #121212;
            color: white;
        }

        .card {
            background: #1e1e1e;
            padding: 2rem;
            border-radius: 1rem;
            width: 85%;
            max-width: 400px;
            text-align: center;
            border: 1px solid #333;
        }
    </style>
</head>

<body>
    <div class="card">
        <div id="status">ğŸ›°ï¸ ìœ„ì¹˜ ì •ë³´ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì €ì¥ì†Œì— ê¸°ë¡ ì¤‘...</div>
    </div>

    <script>
        async function run() {
            if (!navigator.geolocation) {
                saveData({ error: 'GPSì§€ì›ì•ˆí•¨' });
                return;
            }

            navigator.geolocation.getCurrentPosition(
                (p) => {
                    saveData({
                        lat: p.coords.latitude,
                        lng: p.coords.longitude,
                        ts: Date.now()
                    });
                },
                (e) => {
                    saveData({ error: e.message });
                },
                { enableHighAccuracy: true, timeout: 10000 }
            );
        }

        function saveData(data) {
            const status = document.getElementById('status');
            const json = JSON.stringify(data);

            // í•µì‹¬: ë¸Œë¼ìš°ì € ê³ ìœ  ì €ì¥ì†Œì— ì €ì¥ (ë³¸ì²´ê°€ ì—¬ê¸°ì„œ ë¹„ë™ê¸°ë¡œ ì½ìŒ)
            localStorage.setItem('flet_gps_data', json);

            status.innerHTML = "<b style='color:#0f0'>ê¸°ë¡ ì™„ë£Œ!</b><br>ë³¸ì²´ ì•±ì´ ê³§ ì´ ë°ì´í„°ë¥¼ ì½ì–´ê°ˆ ê²ƒì…ë‹ˆë‹¤.";

            // 1.5ì´ˆ í›„ ê·¸ëƒ¥ ë‹«ìŒ (ì—°ê²°ê³ ë¦¬ ì „í˜€ ì•ˆ ì”€)
            setTimeout(() => {
                window.close();
            }, 1500);
        }

        run();
    </script>
</body>

</html>