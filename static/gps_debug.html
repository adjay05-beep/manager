<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript GPS Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }

        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
        }

        button:hover {
            background: #1976D2;
        }

        .result {
            margin: 20px 0;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
            min-height: 100px;
        }

        .success {
            color: #4CAF50;
        }

        .error {
            color: #f44336;
        }

        .info {
            color: #2196F3;
        }

        #console {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }

        .log-line {
            margin: 5px 0;
            padding: 5px;
            border-left: 3px solid #2196F3;
            padding-left: 10px;
        }
    </style>
</head>

<body>
    <h1>ğŸ” GPS JavaScript ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>

    <div>
        <button onclick="testGPS()">ğŸ“ GPS ê°€ì ¸ì˜¤ê¸°</button>
        <button onclick="testBridge()">ğŸ”— ë¸Œë¦¬ì§€ í…ŒìŠ¤íŠ¸</button>
        <button onclick="clearConsole()">ğŸ—‘ï¸ ì½˜ì†” ì§€ìš°ê¸°</button>
    </div>

    <div class="result">
        <h3>ê²°ê³¼:</h3>
        <div id="result">ëŒ€ê¸° ì¤‘...</div>
    </div>

    <div class="result">
        <h3>ì½˜ì†” ë¡œê·¸:</h3>
        <div id="console"></div>
    </div>

    <script>
        const resultDiv = document.getElementById('result');
        const consoleDiv = document.getElementById('console');

        function log(message, type = 'info') {
            const line = document.createElement('div');
            line.className = `log-line ${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            console.log(message);
        }

        function clearConsole() {
            consoleDiv.innerHTML = '';
        }

        function testBridge() {
            log('ë¸Œë¦¬ì§€ í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');

            // Try to find bridge
            const bridges = [
                document.querySelector('input[placeholder="SYSTEM_JS_BRIDGE"]'),
                document.querySelector('input[hint_text="SYSTEM_JS_BRIDGE"]'),
                document.querySelector('input[type="text"]')
            ];

            log(`DOMì—ì„œ input ìš”ì†Œ ê²€ìƒ‰ ì¤‘...`, 'info');

            const allInputs = document.querySelectorAll('input');
            log(`ì „ì²´ input ê°œìˆ˜: ${allInputs.length}`, 'info');

            allInputs.forEach((input, i) => {
                log(`Input ${i}: placeholder="${input.placeholder}", hint="${input.getAttribute('hint_text')}", type="${input.type}"`, 'info');
            });

            bridges.forEach((bridge, i) => {
                if (bridge) {
                    log(`ë¸Œë¦¬ì§€ ${i} ë°œê²¬! placeholder="${bridge.placeholder}"`, 'success');
                    bridge.value = 'TEST_SUCCESS_' + Date.now();
                    bridge.dispatchEvent(new Event('input', { bubbles: true }));
                } else {
                    log(`ë¸Œë¦¬ì§€ ${i} ì°¾ì„ ìˆ˜ ì—†ìŒ`, 'error');
                }
            });

            resultDiv.innerHTML = `<span class="info">ë¸Œë¦¬ì§€ ê²€ìƒ‰ ì™„ë£Œ. ì½˜ì†”ì„ í™•ì¸í•˜ì„¸ìš”.</span>`;
        }

        function testGPS() {
            log('GPS í…ŒìŠ¤íŠ¸ ì‹œì‘...', 'info');
            resultDiv.innerHTML = '<span class="info">ìœ„ì¹˜ í™•ì¸ ì¤‘...</span>';

            if (!navigator.geolocation) {
                const msg = 'GPSê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤';
                log(msg, 'error');
                resultDiv.innerHTML = `<span class="error">${msg}</span>`;
                return;
            }

            log('navigator.geolocation ì‚¬ìš© ê°€ëŠ¥', 'success');
            log('getCurrentPosition í˜¸ì¶œ ì¤‘...', 'info');

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    const lat = position.coords.latitude;
                    const lng = position.coords.longitude;
                    const acc = position.coords.accuracy;

                    log(`âœ“ ìœ„ì¹˜ ìˆ˜ì‹  ì„±ê³µ!`, 'success');
                    log(`  ìœ„ë„: ${lat}`, 'success');
                    log(`  ê²½ë„: ${lng}`, 'success');
                    log(`  ì •í™•ë„: ${acc}m`, 'success');

                    resultDiv.innerHTML = `
                        <span class="success">âœ“ GPS ì„±ê³µ!</span><br>
                        ìœ„ë„: ${lat.toFixed(6)}<br>
                        ê²½ë„: ${lng.toFixed(6)}<br>
                        ì •í™•ë„: ${acc.toFixed(0)}m
                    `;

                    // Try to send to bridge
                    log('ë¸Œë¦¬ì§€ë¡œ ê²°ê³¼ ì „ì†¡ ì‹œë„...', 'info');
                    const bridge = document.querySelector('input[placeholder="SYSTEM_JS_BRIDGE"]');
                    if (bridge) {
                        const data = JSON.stringify({ lat, lng });
                        bridge.value = data;
                        bridge.dispatchEvent(new Event('input', { bubbles: true }));
                        log(`ë¸Œë¦¬ì§€ë¡œ ì „ì†¡ ì™„ë£Œ: ${data}`, 'success');
                    } else {
                        log('ë¸Œë¦¬ì§€ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ - Flet ì•±ì—ì„œë§Œ ì‘ë™', 'error');
                    }
                },
                function (error) {
                    let msg = '';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            msg = 'ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            msg = 'ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                            break;
                        case error.TIMEOUT:
                            msg = 'ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤';
                            break;
                        default:
                            msg = 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜: ' + error.message;
                    }

                    log(`âœ— GPS ì˜¤ë¥˜: ${msg}`, 'error');
                    log(`  Code: ${error.code}`, 'error');
                    log(`  Message: ${error.message}`, 'error');

                    resultDiv.innerHTML = `<span class="error">âœ— ${msg}</span>`;
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        // Initial log
        log('í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ', 'success');
        log('ì¤€ë¹„ ì™„ë£Œ. ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í•˜ì„¸ìš”.', 'info');
    </script>
</body>

</html>